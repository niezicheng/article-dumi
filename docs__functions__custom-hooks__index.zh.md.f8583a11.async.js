(self["webpackChunkdocs_dumi"]=self["webpackChunkdocs_dumi"]||[]).push([[2132],{46439:function(e,n,t){"use strict";t.r(n);var a=t(67294),s=t(96089),r=t(65659);t(45139);n["default"]=e=>(a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&s.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),a.createElement(a.Fragment,null,a.createElement("div",{className:"markdown"},a.createElement("h2",{id:"a-hooks-library"},a.createElement(s.AnchorLink,{to:"#a-hooks-library","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"a hooks library"),a.createElement("p",null,a.createElement(s.Link,{to:"https://ahooks.js.org/"},"ahooks")),a.createElement("h2",{id:"ahooks-analysis"},a.createElement(s.AnchorLink,{to:"#ahooks-analysis","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"ahooks-analysis"),a.createElement("p",null,a.createElement(s.Link,{to:"https://gpingfeng.github.io/ahooks-analysis/"},"ahooks-analysis")),a.createElement("h2",{id:"usesynccallback"},a.createElement(s.AnchorLink,{to:"#usesynccallback","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useSyncCallback"),a.createElement("blockquote",null,a.createElement("p",null,"\u81ea\u5b9a\u4e49 ",a.createElement("code",null,"useSyncCallback"),", \u652f\u6301\u7c7b\u4f3c ",a.createElement("code",null,"class")," \u7ec4\u4ef6 ",a.createElement("code",null,"setState")," \u65b9\u6cd5\u7684\u53c2\u6570 ",a.createElement("code",null,"callback")," \u65b9\u6cd5")),a.createElement(r.Z,{code:"import { useEffect, useState, useCallback } from 'react';\n\nconst useSyncCallback = (callback: Function) => {\n  const [proxyState, setProxyState] = useState({ current: false });\n\n  const Func = useCallback(() => {\n    setProxyState({ current: true });\n  }, [proxyState]);\n\n  useEffect(() => {\n    if (proxyState.current === true) {\n      setProxyState({ current: false });\n    }\n  }, [proxyState]);\n\n  useEffect(() => {\n    proxyState.current && callback();\n  });\n\n  return Func;\n};\n\nexport default useSyncCallback;\n\n// \u4f7f\u7528\nconst [count, setCount] = useState(0);\n\nconst handleClick = () => {\n  setCount(9);\n  func(); // 9\n};\n\nconst func = useSyncCallback(() => {\n  console.log(count);\n});",lang:"tsx"}),a.createElement("h2",{id:"usestatewithcallback"},a.createElement(s.AnchorLink,{to:"#usestatewithcallback","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useStateWithCallback"),a.createElement("blockquote",null,a.createElement("p",null,"\u81ea\u5b9a\u4e49\u7684 ",a.createElement("code",null,"useState"),"\uff0c\u652f\u6301\u7c7b\u4f3c ",a.createElement("code",null,"class")," \u7ec4\u4ef6 ",a.createElement("code",null,"setState")," \u542b\u6709 ",a.createElement("code",null,"callback"))),a.createElement(r.Z,{code:"import { useState, useRef, useEffect } from 'react';\n\nconst useStateWithCallback = (initState) => {\n  const [state, setState] = useState(initState);\n  const isUpdate = useRef();\n\n  const setStateWithCallback = (state, callback) => {\n    setState(pre => {\n      isUpdate.current = callback;\n      return (\n        typeof state = 'function' ? state(pre) : state;\n      )\n    })\n  }\n\n  useEffect(() => {\n    if (isUpdate.current) {\n      isUpdate.current();\n    }\n  })\n\n  return [state, setStateWithCallback];\n}\n\n// \u4f7f\u7528\nconst [state, setStateWithCallback] = useStateWithCallback(0);\n\nconst handleClick = () => {\n  setStateWithCallback(9, () => {\n    console.log(count);\n  });\n};",lang:"tsx"}),a.createElement("h2",{id:"usedebounce"},a.createElement(s.AnchorLink,{to:"#usedebounce","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useDebounce"),a.createElement("blockquote",null,a.createElement("p",null,"\u81ea\u5b9a\u4e49\u7684 ",a.createElement("code",null,"useDebounce"),", \u5b9e\u73b0\u9632\u6296\u51fd\u6570\u529f\u80fd")),a.createElement(r.Z,{code:"import { useRef, useEffect } from 'react';\n\nconst useDebounce = (fn, timer = 100, deps = []) => {\n  let timeId = useRef();\n\n  // fn \u51fd\u6570\u63a5\u53d7\u53c2\u6570\n  return (...args) => {\n    useEffect(() => {\n      if (timeId.current) clearTimeout(timeout.current);\n      timeId.current = setTimeout(() => {\n        fn(...args);\n      }, ms);\n    }, deps);\n\n    const cancel = () => {\n      clearTimeout(timeout.current);\n      timeout = null;\n    };\n\n    return [cancel];\n  };\n};\n\n// \u4f7f\u7528\nconst handleClick = useDebounce(e => {\n  console.log(e); // \u70b9\u51fb\u4e8b\u4ef6\u5bf9\u8c61\n}, 100);\n\nconst [cancel] = handleClick(); // \u83b7\u53d6\u9500\u6bc1\u5b9a\u65f6\u5668\u65b9\u6cd5, \u53d6\u6d88\u9632\u6296\u529f\u80fd",lang:"tsx"}),a.createElement("h2",{id:"usethrottle"},a.createElement(s.AnchorLink,{to:"#usethrottle","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useThrottle"),a.createElement("blockquote",null,a.createElement("p",null,"\u81ea\u5b9a\u4e49\u7684 ",a.createElement("code",null,"useThrottle"),", \u5b9e\u73b0\u8282\u6d41\u51fd\u6570\u529f\u80fd")),a.createElement(r.Z,{code:"import { useEffect, useRef, useState } from 'react';\n\nconst useThrottle = (fn, timer = 100, deps = []) => {\n  let previous = useRef(0);\n  let [time, setTime] = useState(timer);\n\n  // fn \u51fd\u6570\u63a5\u53d7\u53c2\u6570\n  return (...args) => {\n    useEffect(() => {\n      let now = Date.now();\n      if (now - previous.current > time) {\n        fn(...args);\n        previous.current = now;\n      }\n    }, deps);\n\n    const cancel = () => {\n      setTime(0);\n    };\n\n    return [cancel];\n  };\n};\n\n// \u4f7f\u7528\nconst handleClick = useThrottle(e => {\n  console.log(e); // \u70b9\u51fb\u4e8b\u4ef6\u5bf9\u8c61\n}, 100);\n\nconst [cancel] = handleClick(); // \u8bbe\u7f6e\u65f6\u95f4\u4e3a 0, \u53d6\u6d88\u8282\u6d41\u529f\u80fd",lang:"tsx"}),a.createElement("h2",{id:"usetitle"},a.createElement(s.AnchorLink,{to:"#usetitle","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useTitle"),a.createElement(r.Z,{code:"import { useEffect } from 'react';\n\nconst useTitle = title => {\n  useEffect(() => {\n    document.title = title;\n  }, []);\n};\n\n// \u4f7f\u7528\nuseTitle('\u6587\u6863\u6807\u9898');",lang:"tsx"}),a.createElement("h2",{id:"useupdate"},a.createElement(s.AnchorLink,{to:"#useupdate","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useUpdate"),a.createElement("blockquote",null,a.createElement("p",null,"\u81ea\u5b9a\u4e49 ",a.createElement("code",null,"useUpdate"),", \u5b9e\u73b0\u7ec4\u4ef6\u7684\u5f3a\u5236\u66f4\u65b0")),a.createElement(r.Z,{code:"import { useState, useReducer } from 'react';\n\n// \u65b9\u5f0f\u4e00\uff08useReducer\uff09\nconst useUpdate = () => {\n  const [, forceUpdate] = useReducer(x => x + 1, 0);\n\n  return forceUpdate;\n};\n\n// \u65b9\u5f0f\u4e8c\uff08useState\uff09\nconst useUpdate = () => {\n  const [, setTime] = useState();\n\n  const forceUpdate = () => {\n    setTime(Date.now());\n  };\n\n  return forceUpdate;\n};\n\nconst handleClick = useUpdate();",lang:"tsx"}),a.createElement("h2",{id:"usescroll"},a.createElement(s.AnchorLink,{to:"#usescroll","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useScroll"),a.createElement("blockquote",null,a.createElement("p",null,"\u81ea\u5b9a\u4e49 ",a.createElement("code",null,"useScroll"),", \u5b9e\u73b0\u76d1\u542c\u4e00\u4e2a\u5143\u7d20\u6eda\u52a8\u4f4d\u7f6e\u7684\u53d8\u5316")),a.createElement(r.Z,{code:"import { useState, useEffect } from 'react';\n\nconst useScroll = scrollRef => {\n  const [pos, setPos] = useState([0, 0]);\n\n  const handleScroll = useCallback(() => {\n    setPos([scrollRef.current.scrollLeft, scrollRef.current.scrollTop]);\n  }, []);\n\n  useEffect(() => {\n    // \u76d1\u542c\u6eda\u52a8\u4e8b\u4ef6\n    scrollRef.current.addEventLister('scroll', handleScroll, false);\n\n    return () => {\n      scrollRef.current.removeEventListener('scroll', handleScroll, false);\n    };\n  }, []);\n\n  return pos;\n};\n\n// \u4f7f\u7528\nconst scrollRef = useRef(); // \u5143\u7d20\u5b9e\u4f8b\n\nconst [x, y] = useScroll(scrollRef);",lang:"tsx"}),a.createElement("h2",{id:"usepersistfn"},a.createElement(s.AnchorLink,{to:"#usepersistfn","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"usePersistFn"),a.createElement("blockquote",null,a.createElement("p",null,"\u4e00\u4e2a\u6301\u4e45\u5316\u51fd\u6570 \u7684 ",a.createElement("code",null,"hooks"),"\uff0c\u4fdd\u8bc1\u51fd\u6570\u5730\u5740\u6c38\u8fdc\u4e0d\u4f1a\u53d8\u5316")),a.createElement(r.Z,{code:"import { useRef } from 'react';\n\ntype noop = (...args: any[]) => any;\n\nfunction usePersistFn<T extends noop>(func: T) {\n  const funcRef = useRef<T>(func);\n  const persistFunc = useRef<T>();\n\n  // \u5c06\u4f20\u5165\u7684 func \u5b58\u50a8\u5230 ref \u4e2d\n  funcRef.current = func;\n\n  if (!persistFunc.current) {\n    persistFunc.current = function(...args) {\n      return funcRef.current.apply(this, args);\n    } as T;\n  }\n\n  return persistFunc.current;\n}\n\nexport default usePersistFn;",lang:"tsx"}),a.createElement("h2",{id:"usepagination"},a.createElement(s.AnchorLink,{to:"#usepagination","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"usePagination"),a.createElement("blockquote",null,a.createElement("p",null,"\u5206\u9875\u6570\u636e\u8bf7\u6c42\u52a0\u8f7d\u5c01\u88c5")),a.createElement(r.Z,{code:"import { useRef, useState, useMemo, useCallback, useEffect } from 'react';\nimport get from 'lodash/get';\nimport set from 'lodash/set';\n\ntype ArgsType = {\n  // \u5206\u9875\u9875\u6570\n  pageNo?: number;\n  // \u5206\u9875\u5927\u5c0f\n  pageSize?: number;\n  [propName: string]?: any;\n}\n\ntype Options = {\n  // \u83b7\u53d6\u6570\u636e\u65b9\u6cd5\n  getData: (params: any) => (params) => Promise;\n  // \u6570\u636e\u603b\u6570 key \u8def\u5f84\n  totalPath?: string;\n  // \u6570\u636e key \u8def\u5f84\n  dataPath?: string;\n  // \u521d\u59cb\u5316\u53c2\u6570\n  initArgs?: ArgsType;\n}\n\nconst usePagination = (options: Options) => {\n  const { getData, totalPath = 'total', dataPath = 'data' } = options;\n\n  const { current: initArgs } = useRef<ArgsType>(options?.initArgs);\n  const [loading, setLoading] = useState(false);\n  const [args, setArgs] = useState<ArgsType>(initArgs);\n  const [result, setResult] = useState(() => {\n    const initRes = {};\n    set(initRes, totalPath, 0);\n    return set(initRes, dataPath, []);\n  });\n\n  const total = useMemo(() => get(result, totalPath, 0), [result, totalPath]);\n  const data = useMemo(() => get(result, dataPath, []), [result, dataPath]);\n\n  const getDataPersist = usePersistFn(getData);\n\n  // \u83b7\u53d6\u6570\u636e\u5904\u7406\u51fd\u6570\n  const _getData = useCallback(() => {\n    setLoading(true);\n    try {\n      const res = await getDataPersist(args);\n      let dataSource = needJackson ? jacksonConverter.parse(JSON.stringify(res)) : res;\n        if (args.pageNo > 1) {\n          setResult((prevResult) => {\n            const newList = [..._get(prevResult, dataPath, []), ..._get(dataSource, dataPath, [])];\n            return _set({ ...dataSource }, dataPath, newList);\n          });\n        } else {\n          setResult(dataSource || _set({}, dataPath, []));\n        }\n    } catch(err) {\n      console.log(err);\n       setLoading(false);\n    }\n  }, []);\n\n  useEffect(_getData, [_getData]);\n\n  // \u5237\u65b0\u65b9\u6cd5\n  const refresh = usePersistFn((type, refreshArgs) => {\n    setArgs(type === 'init' ? { ...initArgs } : { ...args, ...refreshArgs });\n  });\n\n  // \u52a0\u8f7d\u66f4\u591a\u65b9\u6cd5 pageNo + 1\n  const loadMore = usePersistFn(() => {\n    // \u89e6\u53d1\u5206\u9875\u52a0\u8f7d\u66f4\u591a\uff08\n    if (!loading && total > data?.length) {\n      setArgs((prevArgs) => ({ ...prevArgs, pageNo: prevArgs.pageNo + 1 }));\n    }\n  });\n\n  // \u5e95\u90e8\u6e32\u67d3\u4fe1\u606f\n  const renderFooter = useCallback(() => (\n    <Footer loading={loading} hasMore={total > data?.length} />\n  ), [data?.length, loading, total]);\n\n  return { args, setArgs, loading, result, loadMore, renderFooter, refresh };\n};",lang:"tsx"}),a.createElement("h2",{id:"usematchmedia"},a.createElement(s.AnchorLink,{to:"#usematchmedia","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useMatchMedia"),a.createElement("blockquote",null,a.createElement("p",null,"\u5a92\u4f53\u67e5\u8be2\u5339\u914d\u3010\u901a\u8fc7\u76d1\u542c\u7a97\u53e3 ",a.createElement("code",null,"resize")," \u6765\u5224\u65ad\u662f\u5426\u5339\u914d\u5bf9\u5e94\u5c3a\u5bf8\u5c4f\u5e55\u3011")),a.createElement(r.Z,{code:"import { useEffect, useState, useCallback } from 'react';\nimport _throttle from 'lodash/throttle';\n\n// \u54cd\u5e94\u5f0f\u65ad\u70b9\nexport const MEDIA_BREAKPOINT_KEY = {\n  lg: 'lg',\n  md: 'md',\n  sm: 'sm',\n};\n\n// \u54cd\u5e94\u5f0f\u65ad\u70b9\u5217\u8868\nexport const MEDIA_BREAKPOINT_LIST = [\n  { name: MEDIA_BREAKPOINT_KEY.lg, rule: '(min-width: 906px)' },\n  {\n    name: MEDIA_BREAKPOINT_KEY.md,\n    rule: '(min-width: 415px) and (max-width: 905px)',\n  },\n  { name: MEDIA_BREAKPOINT_KEY.sm, rule: '(max-width: 414px)' },\n];\n\nfunction useMatchMedia() {\n  const [currentMedia, setCurrentMedia] = useState(MEDIA_BREAKPOINT_KEY.lg); // \u5f53\u524d\u5a92\u4f53 lg\n\n  const updateMatchResult = useCallback(() => {\n    let result = MEDIA_BREAKPOINT_KEY.lg;\n    if (window) {\n      // \u5f53\u524d\u7a97\u53e3\u662f\u5426\u5339\u914d\u5bf9\u5e94\u7aef\u70b9\u89c4\u5219 currentBreakpoint: { name: '', rule: '' },\n      const currentBreakpoint = MEDIA_BREAKPOINT_LIST.find(\n        it => window.matchMedia(it.rule).matches,\n      );\n      result = currentBreakpoint?.name;\n    }\n    setCurrentMedia(result);\n  }, []);\n\n  useEffect(() => {\n    updateMatchResult();\n    if (window) {\n      const resizeHandler = _throttle(updateMatchResult, 100);\n      // \u76d1\u542c\u7a97\u53e3 resize \u53d8\u5316\uff0c\u66f4\u65b0\u76f8\u5e94 currentMedia \u503c\n      window.addEventListener('resize', resizeHandler);\n      return () => {\n        // \u53d6\u6d88\u76d1\u542c\n        window.removeEventListener('resize', resizeHandler);\n      };\n    }\n    return null;\n  }, [updateMatchResult]);\n\n  const mediaMatchResult = { currentBreakpoint: currentMedia };\n  // \u904d\u5386\u54cd\u5e94\u5f0f\u65ad\u70b9\u5217\u8868\uff0c\u4e3a\u5339\u914d\u7684\u5a92\u4f53\u5c3a\u5bf8 boolean \u6620\u5c04\n  MEDIA_BREAKPOINT_LIST.forEach(it => {\n    mediaMatchResult[it.name] = it.name === currentMedia;\n  });\n  // \u6570\u636e\u683c\u5f0f { lg: true, md: false, ms: false }; \u5f53\u524d\u5339\u914d\u7684\u5c3a\u5bf8\u4e3a lg \u3010'(min-width: 906px)'\u3011\n  return mediaMatchResult;\n}\n\nexport default useMatchMedia;",lang:"ts"}),a.createElement("h2",{id:"usewindowscroll"},a.createElement(s.AnchorLink,{to:"#usewindowscroll","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useWindowScroll"),a.createElement("blockquote",null,a.createElement("p",null,"\u76d1\u542c\u7a97\u53e3\u6eda\u52a8\u53ca\u662f\u5426\u76d1\u542c ",a.createElement("code",null,"resize")," \u65f6\u76d1\u542c")),a.createElement(r.Z,{code:"import _throttle from 'lodash/throttle';\n\nconst useWindowScroll = (handler, includeResize = fasle) => {\n  useEffect(() => {\n    const newHandler = _throttle(handler, 100);\n    window.addEventListener('scroll', newHandler);\n    includeResize && window.addEventListener('resize', newHandler);\n\n    return () => {\n      window.removeEventListener('scroll', newHandler);\n      includeResize && window.removeEventListener('resize', newHandler);\n    };\n  }, [handle, includeResize]);\n};",lang:"ts"}),a.createElement("h2",{id:"usefooterclass"},a.createElement(s.AnchorLink,{to:"#usefooterclass","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"useFooterClass"),a.createElement("blockquote",null,a.createElement("p",null,"\u8fd4\u56de\u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u5e95\u90e8\u5143\u7d20\u9700\u8981\u7684\u7c7b\u540d\u4fe1\u606f\u3010\u662f\u5426\u56fa\u5b9a\u5b9a\u4f4d\u3011")),a.createElement(r.Z,{code:"/**\n * \u901a\u8fc7\u6bd4\u8f83\u5185\u5bb9\u548c\u7a97\u53e3\u9ad8\u5ea6\uff0c\u8fd4\u56de\u5bf9\u5e94\u7684\u5e95\u90e8\u7c7b\u540d\n * @param {*} contentRef\n * @param {*} fixedClass\n * @param {*} footHeight \u5e95\u90e8\u56fa\u5b9a\u9ad8\u5ea6\n * @returns \u7c7b\u540d\n */\nexport useFooterClass = (contentRef, fixedClass, footHeight) => {\n  const [footerClass, setFooterClass] = useState(''); // \u5e95\u90e8\u5143\u7d20\u7c7b\u540d\u5b57\u4e32\n\n  // \u5904\u7406\u51fd\u6570\n  const handler = useCallback(() => {\n    // \u5185\u5bb9\u5143\u7d20\u5b58\u5728\n    if (contentRef.current) {\n      // \u83b7\u53d6\u5ba2\u6237\u7aef\u9ad8\u5ea6\n      const docHeight = document.documentElement.clientHeight;\n      // \u83b7\u53d6\u5185\u5bb9\u5e95\u90e8\u8ddd\u79bb\u7a97\u53e3\u7684\u8ddd\u79bb\n      const contentBtmToTop = contentRef.current.getBoundingClientRect().bottom;\n      // \u662f\u5426\u5e95\u90e8\u56fa\u5b9a\u5b9a\u4f4d\n      const isBottom = docHeight - contentBtmToTop <= footHeight;\n\n      if (isBottom && footerClass !== fixedClass) {\n        setFooterClass(fixedClass);\n      } else if (!isBottom && footerClass !== '') {\n        setFooterClass('');\n      }\n    }\n  }, [fixedClass, footHeight, footerClass, contentRef]);\n\n  useEffect(() => {\n    // \u9996\u6b21\u6e32\u67d3\u8ba1\u7b97\n    handler();\n  }, [handler]);\n\n  // \u5f53\u7a97\u53e3\u6eda\u52a8\u65f6\u51fa\u53d1\u5904\u7406\u51fd\u6570\u8fdb\u884c\u8ba1\u7b97\n  useWindowScroll(handler, true);\n\n  return footerClass;\n}",lang:"ts"}),a.createElement("h3",{id:"\u793a\u4f8b"},a.createElement(s.AnchorLink,{to:"#\u793a\u4f8b","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"\u793a\u4f8b"),a.createElement(r.Z,{code:"import { useRef } from 'react';\nimport { useFooterClass } from '../useFooterClass';\n\nconst FOOTER_HEIGHT = 44;\n\nconst Demo = () => {\n  const contentRef = useRef();\n  const footerClass = useFooterClass(\n    contentRef.current,\n    'fixed',\n    FOOTER_HEIGHT,\n  );\n\n  return (\n    <>\n      {/* \u5934\u90e8\u5143\u7d20 */}\n      <Header />\n      <div ref={contentRef}>\u5185\u5bb9\u4fe1\u606f</div>\n      {/* \u5e95\u90e8\u5143\u7d20 */}\n      <Footer footerClass={footerClass} />\n    </>\n  );\n};",lang:"tsx"}))))}}]);