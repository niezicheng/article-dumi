(self["webpackChunkdocs_dumi"]=self["webpackChunkdocs_dumi"]||[]).push([[7937],{59257:function(e,n,t){"use strict";t.r(n);var l=t(67294),a=t(96089),r=t(65659);t(45139);n["default"]=e=>(l.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&a.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.createElement(l.Fragment,null,l.createElement("div",{className:"markdown"},l.createElement("h2",{id:"upload-\u4e0a\u4f20"},l.createElement(a.AnchorLink,{to:"#upload-\u4e0a\u4f20","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"Upload \u4e0a\u4f20"),l.createElement("p",null,"\u4e0a\u4f20\u56fe\u7247\u6216\u89c6\u9891\u6587\u4ef6"),l.createElement("h2",{id:"\u8bbe\u8ba1\u601d\u8def\u4e0e\u5b9e\u73b0"},l.createElement(a.AnchorLink,{to:"#\u8bbe\u8ba1\u601d\u8def\u4e0e\u5b9e\u73b0","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u8bbe\u8ba1\u601d\u8def\u4e0e\u5b9e\u73b0"),l.createElement("h3",{id:"\u5f15\u7528\u4e09\u65b9\u5e93"},l.createElement(a.AnchorLink,{to:"#\u5f15\u7528\u4e09\u65b9\u5e93","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u5f15\u7528\u4e09\u65b9\u5e93"),l.createElement("table",null,l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"\u5e73\u53f0"),l.createElement("th",null,"\u7b2c\u4e09\u65b9\u5e93"),l.createElement("th",null,"\u8bf4\u660e"))),l.createElement("tbody",null,l.createElement("tr",null,l.createElement("td",null,"RN"),l.createElement("td",null,l.createElement("code",null,"react-native-image-picker")),l.createElement("td",null,l.createElement(a.Link,{to:"https://www.npmjs.com/package/react-native-image-picker"},"\u6587\u6863\u5730\u5740"))),l.createElement("tr",null,l.createElement("td",null,"H5"),l.createElement("td",null,l.createElement("code",null,"input"),": ",l.createElement("code",null,"type='file'")),l.createElement("td",null,l.createElement(a.Link,{to:"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/Input/file"},"\u6587\u6863\u5730\u5740"))),l.createElement("tr",null,l.createElement("td",null,"MP"),l.createElement("td",null,"\u5c0f\u7a0b\u5e8f\u5143\u7d20\u9009\u62e9\u6587\u4ef6 API: ",l.createElement("code",null,"chooseImage")," (\u5fae\u4fe1\u53ef\u4ee5\u4f7f\u7528: ",l.createElement("code",null,"chooseMedia"),")\uff1b\u4e0a\u4f20\u6587\u4ef6 API: ",l.createElement("code",null,"uploadFile")),l.createElement("td",null,l.createElement(a.Link,{to:"https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html"},"\u9009\u62e9\u6587\u6863\u5730\u5740"),"\u3001",l.createElement(a.Link,{to:"https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/wx.uploadFile.html"},"\u4e0a\u4f20\u6587\u6863\u5730\u5740"))))),l.createElement("h3",{id:"h5-input-\u6807\u7b7e\u5b9e\u73b0"},l.createElement(a.AnchorLink,{to:"#h5-input-\u6807\u7b7e\u5b9e\u73b0","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"H5 input \u6807\u7b7e\u5b9e\u73b0"),l.createElement("ul",null,l.createElement("li",null,"\u5c55\u793a\u6837\u5f0f\u5904\u7406",l.createElement("ul",null,l.createElement("li",null,"\u5c06 ",l.createElement("code",null,"input")," \u5b9a\u4f4d\u5360\u6ee1\u7236\u5bb9\u5668\u5e76\u8bbe\u7f6e ",l.createElement("code",null,"opacity: 0"),", \u5177\u4f53\u5c55\u793a\u4ee5\u7236\u5bb9\u5668\u5185\u5176\u5b83\u5b50\u5143\u7d20\u5c55\u793a"))),l.createElement("li",null,"\u5c5e\u6027\u5904\u7406",l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"multiple")," \u4e0a\u4f20\u5355\u4e2a\u6216\u591a\u4e2a\u6587\u4ef6"),l.createElement("li",null,l.createElement("code",null,"accept")," \u63a5\u53d7\u4e0a\u4f20\u7684\u6587\u4ef6\u7c7b\u578b"),l.createElement("li",null,l.createElement("code",null,"onChange")," \u4e0a\u4f20\u8fc7\u7a0b\u4e2d\u9a8c\u8bc1\u5904\u7406\u6587\u4ef6",l.createElement("ul",null,l.createElement("li",null,"\u9a8c\u8bc1\u6587\u4ef6\u5927\u5c0f\u9650\u5236"),l.createElement("li",null,"\u9a8c\u8bc1\u6587\u4ef6\u7c7b\u578b\u9650\u5236")))))),l.createElement("p",null,"\u89e3\u6790 ",l.createElement("code",null,"File")," \u7c7b\u578b\u65b9\u6cd5"),l.createElement("p",null,l.createElement(a.Link,{to:"https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader"},"\u62d3\u5c55 FileReader")),l.createElement(r.Z,{code:"/**\n * \u89e3\u6790\u4e0a\u4f20\u7684 File \u6587\u4ef6\n * @param file File \u7c7b\u578b\u6570\u636e\n * @param index \u5904\u7406\u7b2c\u51e0\u4e2a File \u6587\u4ef6\n */\nconst parseFile = (file: any, index: number) => {\n  return new Promise((resolve, reject) => {\n    // \u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u8bfb\u53d6\u5bf9\u8c61\n    const reader = new FileReader();\n    // \u8bfb\u53d6\u6587\u4ef6\u4ee5 URL \u683c\u5f0f\u7684 Base64 \u5b57\u7b26\u4e32\u4f5c\u4e3a\u7ed3\u679c\u8fd4\u56de\n    reader.readAsDataURL(file);\n    // \u6587\u4ef6\u8bfb\u53d6\u64cd\u4f5c\u5b8c\u6210\u4e8b\u4ef6\n    reader.onload = (e) => {\n      const dataURL = (e.target as any).result;\n      if (!dataURL) {\n        reject?.(`Fail to get the ${index} image`);\n        return;\n      }\n      resolve({ url: dataURL, file });\n    };\n  });\n};\n\n// \u5904\u7406 File \u6570\u636e\u89e3\u6790\u5bf9\u5e94\u7684 url \u5730\u5740\u6570\u636e\nconst imageParsePromiseList = [];\nfor (let i = 0; i < data.length; i++) {\n  imageParsePromiseList.push(parseFile(data[i], i));\n}\n// imageParsePromiseList \u6240\u6709\u6587\u4ef6\u89e3\u6790\u5b8c\u6210\nPromise.all(imageParsePromiseList)\n  .then((imageItems) => {\n    setImgFiles(imageItems);\n  })\n  .catch((error) => console.log(error));\n}",lang:"tsx"}),l.createElement("h3",{id:"\u5c0f\u7a0b\u5e8f\u7aef\u5b9e\u73b0"},l.createElement(a.AnchorLink,{to:"#\u5c0f\u7a0b\u5e8f\u7aef\u5b9e\u73b0","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u5c0f\u7a0b\u5e8f\u7aef\u5b9e\u73b0"),l.createElement(r.Z,{code:"// \u9009\u62e9\u56fe\u7247 API\nchooseImage({\n  count: 9, // \u6700\u591a\u53ef\u4ee5\u9009\u62e9\u7684\u56fe\u7247\u6570\u91cf\n  sourceType: ['album', 'camera'], // \u9009\u62e9\u56fe\u7247\u6765\u6e90\u76f8\u518c\u6216\u76f8\u673a\n  sizeType: ['original'] || ['compressed'], // \u6240\u9009\u7684\u56fe\u7247\u7684\u5c3a\u5bf8\u3010\u539f\u56fe/\u538b\u7f29\u56fe\u3011\u3010\u5b57\u8282\u5c0f\u7a0b\u5e8f API \u6ca1\u6709\u8be5\u5c5e\u6027\u3011\n  success: (res) => {\n    const {\n      tempFilePaths, // \u56fe\u7247\u7684\u672c\u5730\u4e34\u65f6\u6587\u4ef6\u8def\u5f84\u5217\u8868 (\u672c\u5730\u8def\u5f84) \u3010Array.<string>\u3011\n      tempFiles, // \u56fe\u7247\u7684\u672c\u5730\u4e34\u65f6\u6587\u4ef6\u5217\u8868 \u3010Array.<Object>\u3011\n    } = res;\n\n    const {\n      path, // \u672c\u5730\u4e34\u65f6\u6587\u4ef6\u8def\u5f84 (\u672c\u5730\u8def\u5f84)\n      size, // \u672c\u5730\u4e34\u65f6\u6587\u4ef6\u5927\u5c0f\uff0c\u5355\u4f4d B\n    } = tempFiles;\n  }\n});\n\n// filesList = tempFiles || tempFilePaths\n\n// \u6587\u4ef6\u4e0a\u4f20 API, \u5e76\u4f7f\u7528 Promise \u8fdb\u884c\u5c01\u88c5\nconst promiseArr = filesList.map(({ path, size }) => {\n  return new Promise(() => {\n    uploadFile({\n      url: '', // \u5f00\u53d1\u8005\u670d\u52a1\u5668\u5730\u5740\n      filePath: '', // \u8981\u4e0a\u4f20\u6587\u4ef6\u8d44\u6e90\u7684\u8def\u5f84 (\u672c\u5730\u8def\u5f84)\n      header: , // HTTP \u8bf7\u6c42 Header\uff0cHeader \u4e2d\u4e0d\u80fd\u8bbe\u7f6e Referer\n      formData: , // HTTP \u8bf7\u6c42\u4e2d\u5176\u4ed6\u989d\u5916\u7684 form data\n\n      // \u5fae\u4fe1\u548c\u5b57\u8282\n      name: '', // \u6587\u4ef6\u5bf9\u5e94\u7684 key\uff0c\u5f00\u53d1\u8005\u5728\u670d\u52a1\u7aef\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a key \u83b7\u53d6\u6587\u4ef6\u7684\u4e8c\u8fdb\u5236\u5185\u5bb9\n      timeout: , // \u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2\u3010\u5b57\u8282\u6ca1\u6709\u9009\u9879\u5c5e\u6027\u3011\n\n      // \u963f\u91cc\u7cfb\n      fileName: '', // \u6587\u4ef6\u5bf9\u5e94\u7684 key\uff0c\u5f00\u53d1\u8005\u5728\u670d\u52a1\u7aef\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a key \u83b7\u53d6\u6587\u4ef6\u7684\u4e8c\u8fdb\u5236\u5185\u5bb9\n      hideLoading: false, // \u662f\u5426\u9690\u85cf loading \u56fe\n\n      success: (res) => {\n        const {\n          data, // \u8fd4\u56de\u6570\u636e\u4fe1\u606f\n          statusCode, // HTTP \u72b6\u6001\u7801\n          header, // \u670d\u52a1\u5668\u8fd4\u56de\u7684 Header \u3010\u963f\u91cc\u7cfb\u8fd4\u56de\u503c\u5185\u542b\u6709\u8be5\u5c5e\u6027\u3011\n        } = res;\n\n        if (res.statusCode < 200 || res.statusCode >= 300) {\n          return reject('upload failed');\n        }\n        return resolve(res.data);\n      }\n    })\n  })\n})\n\nconst resArr = Promise.all(promiseArray)\n  .then(res => res)\n  .catch(error => throw new Error(error));\n\nreturn resArr;",lang:"ts"}))))}}]);